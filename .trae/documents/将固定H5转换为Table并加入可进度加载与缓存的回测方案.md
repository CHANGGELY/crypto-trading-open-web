## 目标
- 将现有固定（fixed）格式的ETHUSDT 1m H5转换为表（table）格式，支持按时间窗口高效查询与增量加载。
- 在“数据加载阶段”与“模拟阶段”均显示进度与ETA，保证用户可见性。
- 引入窗口级Parquet缓存，后续同窗口回测可秒级启动。

## 转换与数据规范
- 检查原始H5：读取键列表，确认数据键（若多键取主要）。
- 规范列：统一为`timestamp/open/high/low/close/volume`，时间戳统一为UTC毫秒整型；若为ISO字符串或秒级，进行转换。
- 写入新H5（table格式）：`format='table'`，`data_columns=['timestamp']`，`append=True`，启用索引以支持`where`查询。
- 一次性转换：读取全量DataFrame写入table（必要的单次成本）。转换过程中显示转换进度与ETA（基于行数/块数）。
- 输出文件：`ETHUSDT_1m.table.h5`（与原始H5并存，不覆盖原文件）。

## 加载阶段（带进度）
- 优先从table文件按窗口查询：`select(where='timestamp >= start_ms and timestamp <= end_ms', chunksize=N)`，逐块累积，基于已读块数打印`加载进度%`与`ETA`。
- 若查询失败（列名不同或索引缺失），回退：
  - 先尝试末尾行近似选择（基于行计数），再按时间裁剪。
  - 再不行，读取全量后裁剪，并提示一次性转换建议。

## 模拟阶段（带进度）
- 在逐分钟推进过程中，每处理X条数据打印进度百分比与ETA；同时保留简洁文本行，兼容IDE侧边栏的渲染限制。
- 维持既有路径依赖逻辑（阳/阴线路径推进），保证准确性。

## 缓存策略
- 回测完成后自动生成窗口Parquet缓存：`data/cache/ETHUSDT_1m_<start>_<end>.parquet`。
- 下次同窗口优先加载缓存（秒级），否则走table查询。
- 提供配置切换是否启用缓存与缓存目录。

## 指标与可视化（已实现，继续沿用）
- 指标：净值曲线、Sharpe、最大回撤、胜率、周转率、网格循环效率。
- 可视化：净值与回撤图，保存到配置路径。

## 性能与时间预估
- 首次转换（fixed→table）：3–8分钟（取决于磁盘与文件大小）。
- 之后加载一周窗口：几秒到十几秒（chunksize与磁盘决定），模拟约10–40秒，总体<1分钟。
- 若仅用Parquet缓存（跳过table转换）：首次切片一周需读全量或末尾近似行（1–3分钟），后续同窗口秒级。

## 风险与回退
- 固定格式不支持where查询；若table转换失败或数据列不标准，将回退到全量读取并给出修复提示。
- 大文件转换期间显示细粒度进度与ETA，避免“卡住”体验。

## 交付物
- 新的table H5文件：`ETHUSDT_1m.table.h5`。
- 更新的加载逻辑：窗口查询与chunksize进度，回落策略。
- 窗口Parquet缓存与自动生成。
- 文档片段：如何运行一周窗口、如何启用/禁用缓存。

## 你的确认
- 采用table转换的路线（一次性成本，后续高效），并在最近一周窗口（2025-06-08到2025-06-15）进行首轮回测。
- 默认启用窗口Parquet缓存（可关闭）。
- 如果确认，我开始实现并执行转换与一周回测。